<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
    <title>おひるーれっと</title>
  </head>
  <body>

    <!-- DOM Container -->
    <div id="root"></div>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script> -->

    <!-- Material UI -->
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- Component -->
    <script type="text/babel">
        

      const {
        Box,
        Button,
        Checkbox,
        Container,
        Divider,
        List,
        ListItem,
        ListItemIcon,
        ListItemText,
        Stack,
        TextField,
        Typography,
        Paper,
      } = MaterialUI;

      const not = (a, b) => {
        return a.filter((value) => b.indexOf(value) === -1);
      }

      const intersection = (a, b) => {
        return a.filter((value) => b.indexOf(value) !== -1);
      }


      const App = () => {

        const [turnning, setTurnning] = React.useState(false);
        const [choiced, setChoiced] = React.useState('今日のお昼は？');
        const [checked, setChecked] = React.useState([]);

        const [left, setLeft] = React.useState([
          '丸亀製麺',
          'みなと庵',
          'PARIYA',
        ]);

        const [right, setRight] = React.useState([
          'CHOTARO',
          '魚',
          'ごはんやごはん',
          '焼肉',
          'ファミマ',
          'サンマルクカフェ',
          'ガスト',
          'バーミヤン',
        ]);

        // ルーレット
        React.useEffect(() => {
          if (turnning) {

            let index = 0;

            const timerId = setInterval(() => {
              setChoiced(() => {
                index = index < left.length ? index + 1 : 0;
                setChoiced(left[index]);
              })
            }, 50);
            
            return () => clearInterval(timerId);  

          }
        }, [turnning]);

        const leftChecked = intersection(checked, left);
        const rightChecked = intersection(checked, right);


        const handleToggle = value => () => {
          const currentIndex = checked.indexOf(value);
          const newChecked = [...checked];

          if (currentIndex === -1) {
            newChecked.push(value);
          } else {
            newChecked.splice(currentIndex, 1);
          }

          setChecked(newChecked);
        };

        const handleAllRight = () => {
          setRight(right.concat(left));
          setLeft([]);
        };

        const handleCheckedRight = () => {
          setRight(right.concat(leftChecked));
          setLeft(not(left, leftChecked));
          setChecked(not(checked, leftChecked));
        };

        const handleCheckedLeft = () => {
          setLeft(left.concat(rightChecked));
          setRight(not(right, rightChecked));
          setChecked(not(checked, rightChecked));
        };

        const handleAllLeft = () => {
          setLeft(left.concat(right));
          setRight([]);
        };


        const customList = items => (
          <Paper sx={{ width: 200, height: 230, overflow: 'auto' }}>
            <List dense component="div" role="list">
              {items.map((value) => {
                const labelId = `transfer-list-item-${value}-label`;

                return (
                  <ListItem
                    key={value}
                    role="listitem"
                    button
                    onClick={handleToggle(value)}
                  >
                    <ListItemIcon>
                      <Checkbox
                        checked={checked.indexOf(value) !== -1}
                        tabIndex={-1}
                        disableRipple
                        inputProps={{
                          'aria-labelledby': labelId,
                        }}
                      />
                    </ListItemIcon>
                    <ListItemText id={labelId} primary={value} />
                  </ListItem>
                );
              })}
              <ListItem />
            </List>
          </Paper>
        );
        
        return (
          <Container sx={{padding: '5rem'}}>
            <Typography variant="h1" align="center" sx={{margin: '2rem'}}>
              おひるーれっと
            </Typography>
            <Box sx={{display: 'flex', justifyContent: 'space-between'}}>

              <Paper sx={{display: 'flex', flexFlow: 'column', justifyContent: 'space-between', width: '40%', padding: '1rem'}}>

                {/* ディスプレイ */}
                <Typography variant="h4" component="h2" align="center" sx={{margin: '2rem'}}>
                  行くお店
                </Typography>
                <Typography variant="h3" component="p" align="center" sx={{margin: '2rem'}}>
                  {choiced}
                </Typography>

                {/* ボタン */}
                <Box sx={{display: 'flex', width: '100%', justifyContent: 'center'}}>
                  {turnning ? (
                    <Button variant="contained" onClick={() => setTurnning(false)} sx={{padding: '2rem', margin: '2rem'}}>
                      <Typography variant="h4" component="p" align="center">
                        とめる
                      </Typography>
                    </Button>
                  ) : (
                    <Button variant="contained" onClick={() => setTurnning(true)} sx={{padding: '2rem', margin: '2rem'}}>
                      <Typography variant="h4" component="p" align="center">
                        まわす
                      </Typography>
                    </Button>
                  )}
                </Box>
                
              </Paper>

              {/* お店リスト */}
              <Paper sx={{width: '50%', padding: '1rem'}}>
                <Typography variant="h4" component="h2" align="center" sx={{margin: '2rem'}}>
                  お店の候補
                </Typography>
                
                <Box sx={{display: 'flex', justifyContent: 'space-between', margin: '2rem'}}>
                  <Box>
                    <Typography variant="h5" component="h3" align="center">
                        あり
                    </Typography>
                    {customList(left)}
                  </Box>
                  <Box>
                    <Box sx={{display: 'flex', flexFlow: 'column', justifyContent: 'center', height: '100%'}}>
                      <Button
                        sx={{ my: 0.5 }}
                        variant="outlined"
                        size="small"
                        onClick={handleAllRight}
                        disabled={left.length === 0}
                        aria-label="move all right"
                      >
                        ≫
                      </Button>
                      <Button
                        sx={{ my: 0.5 }}
                        variant="outlined"
                        size="small"
                        onClick={handleCheckedRight}
                        disabled={leftChecked.length === 0}
                        aria-label="move selected right"
                      >
                        &gt;
                      </Button>
                      <Button
                        sx={{ my: 0.5 }}
                        variant="outlined"
                        size="small"
                        onClick={handleCheckedLeft}
                        disabled={rightChecked.length === 0}
                        aria-label="move selected left"
                      >
                        &lt;
                      </Button>
                      <Button
                        sx={{ my: 0.5 }}
                        variant="outlined"
                        size="small"
                        onClick={handleAllLeft}
                        disabled={right.length === 0}
                        aria-label="move all left"
                      >
                        ≪
                      </Button>
                    </Box>
                  </Box>
                  <Box>
                    <Typography variant="h5" component="h3" align="center">
                        なし
                    </Typography>
                    {customList(right)}
                    </Box>
                </Box>

              </Paper>

            </Box>
          </Container>
        )
      }


      ReactDOM
        .createRoot(document.getElementById('root'))
        .render(<App />);


    </script>
  </body>
</html>
